<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>CrapsEdge™ Real Table — Educational Simulator</title>
<style>
  :root{
    --felt:#0c6b46; --felt-dark:#0a5a3b; --ink:#f5fff9; --mut:#cfe7db;
    --line:#083f2c; --chip1:#d9534f; --chip2:#4aa3ff; --chip3:#60d394; --chip4:#f4c542;
    --rail:#10251c; --shadow:rgba(0,0,0,.35); --accent:#39ff88;
  }
  *{box-sizing:border-box}
  body{margin:0;background:#071a14;color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Inter,Roboto,Arial}
  .wrap{max-width:1200px;margin:20px auto;padding:12px}
  .hud{display:flex;gap:10px;align-items:center;margin-bottom:10px}
  .bank{background:#0f2c20;border:1px solid #184a35;border-radius:10px;padding:8px 12px}
  .btn{cursor:pointer;border:1px solid #1b4635;background:#103425;color:#fff;border-radius:10px;padding:8px 12px;font-weight:600}
  .btn.primary{background:var(--accent);color:#012314;border-color:#4dffa3}
  .btn.ghost{background:transparent}
  .denoms{display:flex;gap:8px;margin-left:auto}
  .chipSel{width:36px;height:36px;border-radius:50%;border:3px solid #fff;box-shadow:0 3px 10px var(--shadow);display:grid;place-items:center;font-weight:800}
  .c1{background:var(--chip1)} .c2{background:var(--chip2)} .c3{background:var(--chip3)} .c4{background:var(--chip4)}
  .chipSel.active{outline:3px solid #fff}
  .table{
    position:relative;aspect-ratio:2.1/1;
    background:radial-gradient(140% 120% at 50% 40%, var(--felt) 0, var(--felt-dark) 70%);
    border-radius:22px;border:8px solid var(--rail);box-shadow:0 20px 60px var(--shadow), inset 0 0 0 2px #0e3c29;
    overflow:hidden;
  }
  .layout{position:absolute;inset:12px;border:2px solid #0e4e37;border-radius:16px;padding:10px}
  .zone{position:absolute;border:2px solid #0e4e37;border-radius:10px;color:var(--mut);text-align:center;padding-top:8px}
  .zone .label{font-size:14px;font-weight:800;letter-spacing:.5px}
  .zone .amt{position:absolute;right:6px;bottom:4px;font-size:12px;color:#fff;text-shadow:0 2px 3px #0006}
  .zone.active{outline:3px solid #fff}
  /* Layout coordinates (percent of table) */
  .pass {left:2%; right:2%; bottom:2%; height:18%;}
  .dontpass {left:2%; right:2%; bottom:21%; height:10%;}
  .field {left:2%; right:2%; bottom:32%; height:20%;}
  .box.n4 {left:3%; width:14%; top:8%; height:22%}
  .box.n5 {left:19%; width:14%; top:8%; height:22%}
  .box.n6 {left:35%; width:14%; top:8%; height:22%}
  .box.n8 {left:51%; width:14%; top:8%; height:22%}
  .box.n9 {left:67%; width:14%; top:8%; height:22%}
  .box.n10{left:83%; width:14%; top:8%; height:22%}
  /* Point puck */
  .puck{position:absolute;top:6%; left:2%; width:78px;height:38px;border-radius:20px;display:grid;place-items:center;font-weight:900;border:3px solid #fff;box-shadow:0 4px 10px var(--shadow)}
  .off{background:#111;color:#fff} .on{background:#fff;color:#111}
  /* Chips rendered on table */
  .chip{position:absolute; width:34px;height:34px;border-radius:50%;border:3px solid #fff;
        box-shadow:0 6px 18px var(--shadow); display:grid; place-items:center; font-weight:900; color:#111}
  .chip.c1{background:var(--chip1)} .chip.c2{background:var(--chip2)} .chip.c3{background:var(--chip3)} .chip.c4{background:var(--chip4)}
  /* Dice */
  .dice{position:absolute; top:40%; left:45%; width:48px; height:48px; border-radius:6px; background:#fff; color:#111; display:grid; place-items:center; font-size:24px; box-shadow:0 8px 20px var(--shadow); transform:rotate(0deg)}
  .dice.d2{left:52%}
  @keyframes toss {
    0%{transform:translate(-220px,-120px) rotate(0deg)}
    60%{transform:translate(40px,10px) rotate(620deg)}
    100%{transform:translate(0,0) rotate(720deg)}
  }
  .rolling{animation:toss .7s cubic-bezier(.2,.7,.2,1)}
  /* Log */
  .log{margin-top:10px;height:160px;overflow:auto;background:#0e2e22;border:1px solid #1b4d3a;border-radius:10px;padding:8px;line-height:1.5}
  .ok{color:var(--accent)} .bad{color:#ff6b6b} .mut{color:var(--mut)}
  /* Overlay (optional paywall) */
  .overlay{position:fixed;inset:0;background:rgba(3,6,10,.88);display:none;place-items:center;z-index:9999}
  .pay{max-width:520px;background:#0d2230;border:1px solid #254866;border-radius:14px;padding:22px;text-align:center;color:#eaf4ff}
  .pay h2{margin:0 0 10px}
</style>
</head>
<body>
<div class="wrap">
  <div class="hud">
    <div class="bank">Bank: <b id="bank">$1,000</b> &nbsp; | &nbsp; Point: <b id="point">—</b></div>
    <button class="btn" id="undo">Undo</button>
    <button class="btn" id="clear">Clear Bets</button>
    <button class="btn primary" id="roll">Roll Dice</button>
    <div class="denoms">
      <div class="chipSel c1 active" data-val="5">$5</div>
      <div class="chipSel c2" data-val="10">$10</div>
      <div class="chipSel c3" data-val="25">$25</div>
      <div class="chipSel c4" data-val="100">$100</div>
    </div>
  </div>

  <div class="table" id="table">
    <div class="layout">
      <div id="puck" class="puck off">OFF</div>

      <div class="zone pass" data-area="pass"><div class="label">PASS LINE</div><div class="amt" id="amt-pass">—</div></div>
      <div class="zone dontpass" data-area="dontpass"><div class="label">DON'T PASS</div><div class="amt" id="amt-dp">—</div></div>
      <div class="zone field" data-area="field"><div class="label">FIELD <span style="font-size:12px">(2 & 12 pay 2:1)</span></div><div class="amt" id="amt-field">—</div></div>

      <div class="zone box n4"  data-area="pl4"><div class="label">4</div><div class="amt" id="amt-pl4">—</div></div>
      <div class="zone box n5"  data-area="pl5"><div class="label">5</div><div class="amt" id="amt-pl5">—</div></div>
      <div class="zone box n6"  data-area="pl6"><div class="label">6</div><div class="amt" id="amt-pl6">—</div></div>
      <div class="zone box n8"  data-area="pl8"><div class="label">8</div><div class="amt" id="amt-pl8">—</div></div>
      <div class="zone box n9"  data-area="pl9"><div class="label">9</div><div class="amt" id="amt-pl9">—</div></div>
      <div class="zone box n10" data-area="pl10"><div class="label">10</div><div class="amt" id="amt-pl10">—</div></div>

      <!-- Dice -->
      <div id="d1" class="dice d1">5</div>
      <div id="d2" class="dice d2">2</div>
    </div>
  </div>

  <div class="log" id="log"></div>
</div>

<!-- Optional 5-min paywall overlay -->
<div id="overlay" class="overlay">
  <div class="pay">
    <h2>Session limit reached</h2>
    <p>You’ve used your free 5-minute demo. Unlock unlimited practice, advanced drills, and member features.</p>
    <p><a href="https://crapsedge.gumroad.com/l/xvnyi" target="_blank"><button class="btn primary">Unlock Full Access</button></a>
       <button class="btn" onclick="location.reload()">Restart Demo</button></p>
    <p class="mut" style="font-size:12px;margin-top:8px">Educational tool — no real-money wagering.</p>
  </div>
</div>

<script>
(()=>{
  // ------- SETTINGS -------
  const ENABLE_TIMER = true;           // set to false to disable the 5-min overlay
  const DEMO_MS = 5*60*1000;           // 5 minutes
  const FIELD_PAYS_DOUBLE_ON = [2,12]; // 2:1 for 2 and 12

  // ------- STATE -------
  let bank=1000, point=null;    // point null means come-out
  let bets = { pass:0, dontpass:0, field:0, pl4:0,pl5:0,pl6:0,pl8:0,pl9:0,pl10:0 };
  let lastChips=[];             // for undo (array of {area,amt,chipEl})
  let denom = 5;

  // ------- HELPERS -------
  const $=id=>document.getElementById(id);
  const money=n=>'$'+n.toLocaleString();
  const log = (msg, cls='') => { const d=document.createElement('div'); d.innerHTML=msg; if(cls) d.className=cls; $('log').prepend(d); };
  const setAmt=(id,val)=> $(id).textContent = val>0? money(val) : '—';
  const refresh=()=>{
    $('bank').textContent = money(bank);
    $('point').textContent = point? point:'—';
    setAmt('amt-pass', bets.pass);
    setAmt('amt-dp', bets.dontpass);
    setAmt('amt-field', bets.field);
    setAmt('amt-pl4', bets.pl4); setAmt('amt-pl5', bets.pl5); setAmt('amt-pl6', bets.pl6);
    setAmt('amt-pl8', bets.pl8); setAmt('amt-pl9', bets.pl9); setAmt('amt-pl10', bets.pl10);
    $('puck').className = 'puck ' + (point? 'on':'off');
    $('puck').textContent = point? 'ON '+point : 'OFF';
  };
  const payPlace=(num, amt)=>{
    if(!amt) return 0;
    if(num===4||num===10) return Math.floor(amt*9/5);
    if(num===5||num===9)  return Math.floor(amt*7/5);
    if(num===6||num===8)  return Math.floor(amt*7/6);
    return 0;
  };

  // ------- CHIP RENDERING -------
  const areaCenter = (el)=>{
    const r=el.getBoundingClientRect(), p=$('table').getBoundingClientRect();
    return { x: r.left - p.left + r.width/2, y: r.top - p.top + r.height/2 };
  };
  const makeChip = (amt, parentEl)=>{
    const chip = document.createElement('div');
    const cls = amt>=100? 'c4' : amt>=25? 'c3' : amt>=10? 'c2':'c1';
    chip.className = 'chip '+cls;
    chip.textContent = '$'+amt;
    const c = areaCenter(parentEl);
    chip.style.left = (c.x - 17 + (Math.random()*10-5)) + 'px';
    chip.style.top  = (c.y - 17 + (Math.random()*8-4)) + 'px';
    $('table').appendChild(chip);
    return chip;
  };

  // ------- SELECT DENOM -------
  document.querySelectorAll('.chipSel').forEach(s=>{
    s.addEventListener('click',()=>{
      document.querySelectorAll('.chipSel').forEach(x=>x.classList.remove('active'));
      s.classList.add('active'); denom = +s.dataset.val;
    });
  });

  // ------- PLACE/REMOVE BETS BY TAPPING ZONES -------
  document.querySelectorAll('.zone').forEach(z=>{
    z.addEventListener('click',()=>{
      const area=z.dataset.area;
      // Basic rules: Pass/Don't only on come-out
      if((area==='pass'||area==='dontpass') && point){
        alert('Pass/Don’t Pass only on the come-out roll.');
        return;
      }
      if(bank<denom) { alert('Not enough bank.'); return; }
      bank -= denom; bets[area]+=denom;
      const chipEl = makeChip(denom, z);
      lastChips.push({area, amt:denom, chipEl});
      refresh();
    });
  });

  // ------- UNDO / CLEAR -------
  $('undo').onclick=()=>{
    const last = lastChips.pop();
    if(!last) return;
    bank += last.amt; bets[last.area]-=last.amt;
    last.chipEl.remove();
    refresh();
  };
  $('clear').onclick=()=>{
    bank += Object.values(bets).reduce((a,b)=>a+b,0);
    bets = { pass:0, dontpass:0, field:0, pl4:0,pl5:0,pl6:0,pl8:0,pl9:0,pl10:0 };
    lastChips.forEach(c=>c.chipEl.remove()); lastChips=[];
    refresh();
  };

  // ------- DICE ANIMATION + ROLL -------
  const diceFaces = ['','1','2','3','4','5','6']; // we render numbers; look crisp on mobile
  const rollDice = ()=>{
    const d1 = 1+Math.floor(Math.random()*6);
    const d2 = 1+Math.floor(Math.random()*6);
    const a1=$('d1'), a2=$('d2');
    a1.classList.add('rolling'); a2.classList.add('rolling');
    a1.textContent=''; a2.textContent='';
    setTimeout(()=>{ a1.textContent=diceFaces[d1]; a2.textContent=diceFaces[d2];
                     a1.classList.remove('rolling'); a2.classList.remove('rolling'); }, 700);
    return new Promise(res=> setTimeout(()=>res([d1,d2,d1+d2]), 720));
  };

  // ------- RESOLUTION -------
  function resolveComeOut(sum){
    // Field resolves immediately each roll
    if(bets.field){
      if([2,3,4,9,10,11,12].includes(sum)){
        const mult = FIELD_PAYS_DOUBLE_ON.includes(sum)? 2 : 1;
        bank += bets.field*(1+mult);
        log(`Field ${sum} pays ${mult}:1 (+${money(bets.field*mult)})`,'ok');
      } else {
        log(`Field loses`,'bad');
      }
      bets.field=0;
    }

    if(sum===7||sum===11){
      if(bets.pass){ bank += bets.pass*2; log(`Natural ${sum}: Pass Line wins +${money(bets.pass)}`,'ok'); bets.pass=0; }
      if(bets.dontpass){ log(`Natural: Don’t Pass loses ${money(bets.dontpass)}`,'bad'); bets.dontpass=0; }
    } else if([2,3,12].includes(sum)){
      if(bets.pass){ log(`Craps ${sum}: Pass Line loses ${money(bets.pass)}`,'bad'); bets.pass=0; }
      if(bets.dontpass){
        if(sum===12){ bank+=bets.dontpass; log(`Bar 12 on Don’t — push`,'mut'); }
        else { bank+=bets.dontpass*2; log(`Don’t Pass wins on ${sum} +${money(bets.dontpass)}`,'ok'); }
        bets.dontpass=0;
      }
    } else {
      point = sum; log(`Point established: <b>${point}</b>`,'mut');
    }
  }

  function resolvePoint(sum){
    // Field
    if(bets.field){
      if([2,3,4,9,10,11,12].includes(sum)){
        const mult = FIELD_PAYS_DOUBLE_ON.includes(sum)? 2 : 1;
        bank += bets.field*(1+mult);
        log(`Field ${sum} pays ${mult}:1 (+${money(bets.field*mult)})`,'ok');
      } else log(`Field loses`,'bad');
      bets.field=0;
    }

    if(sum===7){
      if(bets.pass){ log(`Seven-out: Pass loses ${money(bets.pass)}`,'bad'); }
      if(bets.dontpass){ bank+=bets.dontpass*2; log(`Seven-out: Don’t Pass wins +${money(bets.dontpass)}`,'ok'); }
      // All place bets lose on 7
      [4,5,6,8,9,10].forEach(n=>{
        const key='pl'+n; if(bets[key]){ log(`Place ${n} loses ${money(bets[key])}`,'bad'); bets[key]=0; }
      });
      bets.pass=0; bets.dontpass=0; point=null; return;
    }

    if(sum===point){
      if(bets.pass){ bank += bets.pass*2; log(`HIT THE POINT ${point}: Pass pays +${money(bets.pass)}`,'ok'); bets.pass=0; }
      if(bets.dontpass){ log(`Point hit: Don’t Pass loses ${money(bets.dontpass)}`,'bad'); bets.dontpass=0; }
      // Place on the point pays too
      const k='pl'+point;
      if(bets[k]){ const w=payPlace(point,bets[k]); bank+=w; log(`Place ${point} hits +${money(w)}`,'ok'); }
      point=null; return;
    }

    // Non-7, non-point: pay place bets that match sum
    const map={4:'pl4',5:'pl5',6:'pl6',8:'pl8',9:'pl9',10:'pl10'};
    const key = map[sum];
    if(key && bets[key]){
      const w=payPlace(sum,bets[key]); bank += w;
      log(`Place ${sum} hits +${money(w)}`,'ok');
    }
  }

  // ------- ROLL BUTTON -------
  $('roll').onclick=async ()=>{
    const [d1,d2,sum] = await rollDice();
    log(`Roll: <b>${d1}+${d2} = ${sum}</b>`);
    if(!point) resolveComeOut(sum); else resolvePoint(sum);
    refresh();
  };

  // ------- INIT -------
  refresh();
  log('Welcome! Tap chip amount, then tap the felt to place chips. Press ROLL to play.','mut');

  // ------- TIMER -------
  if(ENABLE_TIMER){
    setTimeout(()=>{ document.getElementById('overlay').style.display='grid'; }, DEMO_MS);
  }
})();
</script>
</body>
</html>
